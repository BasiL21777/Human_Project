<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Edit User Role</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
  <style>
    .admin-container {
      background-color: var(--neuro-dark, #0a0a1a);
      color: var(--neuro-light, #e0f8ff);
      padding: 2rem 3rem;
      min-height: 70vh;
      font-family: 'Poppins', sans-serif;
    }
    h1 { color: var(--neuro-primary, #6e00ff); margin-bottom: 2rem; }
    .role-form {
      background: var(--neuro-glass, rgba(255,255,255,0.08));
      border: 1px solid var(--neuro-glass-border, rgba(255,255,255,0.2));
      border-radius: 15px;
      padding: 2rem 3rem;
      max-width: 500px;
      box-shadow: 0 0 20px rgba(110,0,255,0.2);
    }
    .form-group { margin-bottom: 1.8rem; }
    label { display:block; margin-bottom:0.6rem; font-weight:600; color:var(--neuro-secondary,#00f0ff); }
    select.form-control {
      width:100%; padding:0.7rem 1rem; border-radius:10px;
      border:1px solid var(--neuro-glass-border,rgba(255,255,255,0.2));
      background-color:var(--neuro-dark,#0a0a1a); color:var(--neuro-light,#e0f8ff);
      font-size:1rem; outline:none; box-shadow:inset 0 0 8px rgba(110,0,255,0.3);
    }
    .btn { padding:0.75rem 1.8rem; border-radius:30px; font-weight:600; cursor:pointer; border:none;
      font-size:1rem; transition:all 0.3s ease; box-shadow:0 5px 15px rgba(110,0,255,0.4); margin-right:1rem; }
    .btn-primary { background-color:var(--neuro-success,#00ff88); color:var(--neuro-dark,#0a0a1a); }
    .btn-primary:hover { background-color:#00cc6a; box-shadow:0 8px 20px #00cc6a; transform:translateY(-2px); }
    .btn-secondary { background-color:var(--neuro-secondary,#00f0ff); color:var(--neuro-dark,#0a0a1a); }
    .btn-secondary:hover { background-color:#00c4d6; box-shadow:0 8px 20px #00c4d6; transform:translateY(-2px); }
  </style>
</head>
<body>
<div class="admin-container">
  <h1 id="pageTitle">Edit User Role</h1>
  <div class="role-form">
    <form id="roleForm">
      <div class="form-group">
        <label for="role">Role:</label>
        <select id="role" class="form-control" required>
          <option value="Patient_ROLE">Patient</option>
          <option value="Doctor_ROLE">Doctor</option>
          <option value="Admin_ROLE">Admin</option>
        </select>
      </div>
      <button type="submit" class="btn btn-primary">Update Role</button>
      <a href="/admin/users.html" class="btn btn-secondary">Cancel</a>
    </form>
  </div>
</div>

<script>
const BASE_URL = "http://localhost:5000";

// Get user ID from query string ?id=...
const params = new URLSearchParams(window.location.search);
const userId = params.get("id");

async function loadUser(){
  const token = localStorage.getItem("access_token");
  if(!userId){ alert("No user ID provided"); return; }
  try {
    const res = await fetch(`${BASE_URL}/api/users/${userId}`, {
      headers:{ Authorization:`Bearer ${token}` }
    });
    const user = await res.json();
    document.getElementById("pageTitle").textContent = `Edit Role for ${user.email}`;
    document.getElementById("role").value = user.role;
  } catch(err){ console.error("Error loading user:", err); }
}

document.getElementById("roleForm").addEventListener("submit", async e=>{
  e.preventDefault();
  const token = localStorage.getItem("access_token");
  const newRole = document.getElementById("role").value;
  try {
    const res = await fetch(`${BASE_URL}/api/users/${userId}`, {
      method:"PUT",
      headers:{ Authorization:`Bearer ${token}`, "Content-Type":"application/json" },
      body: JSON.stringify({ role:newRole })
    });
    if(res.ok){
      alert("Role updated successfully");
      window.location.href="/admin/users.html";
    } else {
      const errData = await res.json();
      alert("Error updating role: "+errData.error);
    }
  } catch(err){ console.error("Update error:", err); }
});

// Run on page load
loadUser();
</script>
</body>
</html>
